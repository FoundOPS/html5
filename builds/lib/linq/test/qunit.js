/*
 * QUnit - A JavaScript Unit Testing Framework
 * 
 * http://docs.jquery.com/QUnit
 *
 * Copyright (c) 2009 John Resig, JÃ¶rn Zaefferer
 * Dual licensed under the MIT (MIT-LICENSE.txt)
 * and GPL (GPL-LICENSE.txt) licenses.
 */

/**
 * jsDump
 * Copyright (c) 2008 Ariel Flesler - aflesler(at)gmail(dot)com | http://flesler.blogspot.com
 * Licensed under BSD (http://www.opensource.org/licenses/bsd-license.php)
 * Date: 5/15/2008
 * @projectDescription Advanced and extensible data dumping for Javascript.
 * @version 1.0.0
 * @author Ariel Flesler
 * @link {http://flesler.blogspot.com/2008/05/jsdump-pretty-dump-of-any-javascript.html}
 */

(function(window){function done(){config.doneTimer&&window.clearTimeout&&(window.clearTimeout(config.doneTimer),config.doneTimer=null);if(config.queue.length){config.doneTimer=window.setTimeout(function(){config.queue.length?synchronize(done):done()},13);return}config.autorun=!0,config.currentModule&&QUnit.moduleDone(config.currentModule,config.moduleStats.bad,config.moduleStats.all);var banner=id("qunit-banner"),tests=id("qunit-tests"),html=["Tests completed in ",+(new Date)-config.started," milliseconds.<br/>",'<span class="passed">',config.stats.all-config.stats.bad,'</span> tests of <span class="total">',config.stats.all,'</span> passed, <span class="failed">',config.stats.bad,"</span> failed."].join("");banner&&(banner.className=config.stats.bad?"qunit-fail":"qunit-pass");if(tests){var result=id("qunit-testresult");result||(result=document.createElement("p"),result.id="qunit-testresult",result.className="result",tests.parentNode.insertBefore(result,tests.nextSibling)),result.innerHTML=html}QUnit.done(config.stats.bad,config.stats.all)}function validTest(name){var i=config.filters.length,run=!1;if(!i)return!0;while(i--){var filter=config.filters[i],not=filter.charAt(0)=="!";not&&(filter=filter.slice(1));if(name.indexOf(filter)!==-1)return!not;not&&(run=!0)}return run}function push(result,actual,expected,message){message=message||(result?"okay":"failed"),QUnit.ok(result,result?message+": "+QUnit.jsDump.parse(expected):message+", expected: "+QUnit.jsDump.parse(expected)+" result: "+QUnit.jsDump.parse(actual))}function synchronize(callback){config.queue.push(callback),config.autorun&&!config.blocking&&process()}function process(){var start=(new Date).getTime();while(config.queue.length&&!config.blocking){if(!(config.updateRate<=0||(new Date).getTime()-start<config.updateRate)){setTimeout(process,13);break}config.queue.shift()()}}function saveGlobal(){config.pollution=[];if(config.noglobals)for(var key in window)config.pollution.push(key)}function checkPollution(name){var old=config.pollution;saveGlobal();var newGlobals=diff(old,config.pollution);newGlobals.length>0&&(ok(!1,"Introduced global variable(s): "+newGlobals.join(", ")),config.expected++);var deletedGlobals=diff(config.pollution,old);deletedGlobals.length>0&&(ok(!1,"Deleted global variable(s): "+deletedGlobals.join(", ")),config.expected++)}function diff(a,b){var result=a.slice();for(var i=0;i<result.length;i++)for(var j=0;j<b.length;j++)if(result[i]===b[j]){result.splice(i,1),i--;break}return result}function fail(message,exception,callback){typeof console!="undefined"&&console.error&&console.warn?(console.error(message),console.error(exception),console.warn(callback.toString())):window.opera&&opera.postError&&opera.postError(message,exception,callback.toString)}function extend(a,b){for(var prop in b)a[prop]=b[prop];return a}function addEvent(elem,type,fn){elem.addEventListener?elem.addEventListener(type,fn,!1):elem.attachEvent?elem.attachEvent("on"+type,fn):fn()}function id(name){return typeof document!="undefined"&&!!document&&!!document.getElementById&&document.getElementById(name)}var QUnit={init:function(){config={stats:{all:0,bad:0},moduleStats:{all:0,bad:0},started:+(new Date),updateRate:1e3,blocking:!1,autorun:!1,assertions:[],filters:[],queue:[]};var tests=id("qunit-tests"),banner=id("qunit-banner"),result=id("qunit-testresult");tests&&(tests.innerHTML=""),banner&&(banner.className=""),result&&result.parentNode.removeChild(result)},module:function(name,testEnvironment){config.currentModule=name,synchronize(function(){config.currentModule&&QUnit.moduleDone(config.currentModule,config.moduleStats.bad,config.moduleStats.all),config.currentModule=name,config.moduleTestEnvironment=testEnvironment,config.moduleStats={all:0,bad:0},QUnit.moduleStart(name,testEnvironment)})},asyncTest:function(testName,expected,callback){arguments.length===2&&(callback=expected,expected=0),QUnit.test(testName,expected,callback,!0)},test:function(testName,expected,callback,async){var name=testName,testEnvironment,testEnvironmentArg;arguments.length===2&&(callback=expected,expected=null),expected&&typeof expected=="object"&&(testEnvironmentArg=expected,expected=null),config.currentModule&&(name=config.currentModule+" module: "+name);if(!validTest(name))return;synchronize(function(){QUnit.testStart(testName),testEnvironment=extend({setup:function(){},teardown:function(){}},config.moduleTestEnvironment),testEnvironmentArg&&extend(testEnvironment,testEnvironmentArg),QUnit.current_testEnvironment=testEnvironment,config.assertions=[],config.expected=expected;try{config.pollution||saveGlobal(),testEnvironment.setup.call(testEnvironment)}catch(e){QUnit.ok(!1,"Setup failed on "+name+": "+e.message)}async&&QUnit.stop();try{callback.call(testEnvironment)}catch(e){fail("Test "+name+" died, exception and test follows",e,callback),QUnit.ok(!1,"Died on test #"+(config.assertions.length+1)+": "+e.message),saveGlobal(),config.blocking&&start()}}),synchronize(function(){try{checkPollution(),testEnvironment.teardown.call(testEnvironment)}catch(e){QUnit.ok(!1,"Teardown failed on "+name+": "+e.message)}try{QUnit.reset()}catch(e){fail("reset() failed, following Test "+name+", exception and reset fn follows",e,reset)}config.expected&&config.expected!=config.assertions.length&&QUnit.ok(!1,"Expected "+config.expected+" assertions, but "+config.assertions.length+" were run");var good=0,bad=0,tests=id("qunit-tests");config.stats.all+=config.assertions.length,config.moduleStats.all+=config.assertions.length;if(tests){var ol=document.createElement("ol");ol.style.display="none";for(var i=0;i<config.assertions.length;i++){var assertion=config.assertions[i],li=document.createElement("li");li.className=assertion.result?"pass":"fail",li.appendChild(document.createTextNode(assertion.message||"(no message)")),ol.appendChild(li),assertion.result?good++:(bad++,config.stats.bad++,config.moduleStats.bad++)}var b=document.createElement("strong");b.innerHTML=name+" <b style='color:black;'>(<b class='fail'>"+bad+"</b>, <b class='pass'>"+good+"</b>, "+config.assertions.length+")</b>",addEvent(b,"click",function(){var next=b.nextSibling,display=next.style.display;next.style.display=display==="none"?"block":"none"}),addEvent(b,"dblclick",function(e){var target=e&&e.target?e.target:window.event.srcElement;if(target.nodeName.toLowerCase()==="strong"){var text="",node=target.firstChild;while(node.nodeType===3)text+=node.nodeValue,node=node.nextSibling;text=text.replace(/(^\s*|\s*$)/g,""),window.location&&(window.location.href=window.location.href.match(/^(.+?)(\?.*)?$/)[1]+"?"+encodeURIComponent(text))}});var li=document.createElement("li");li.className=bad?"fail":"pass",li.appendChild(b),li.appendChild(ol),tests.appendChild(li);if(bad){var toolbar=id("qunit-testrunner-toolbar");toolbar&&(toolbar.style.display="block",id("qunit-filter-pass").disabled=null,id("qunit-filter-missing").disabled=null)}}else for(var i=0;i<config.assertions.length;i++)config.assertions[i].result||(bad++,config.stats.bad++,config.moduleStats.bad++);QUnit.testDone(testName,bad,config.assertions.length),!window.setTimeout&&!config.queue.length&&done()}),window.setTimeout&&!config.doneTimer&&(config.doneTimer=window.setTimeout(function(){config.queue.length?synchronize(done):done()},13))},expect:function(asserts){config.expected=asserts},ok:function(a,msg){QUnit.log(a,msg),config.assertions.push({result:!!a,message:msg})},equal:function(actual,expected,message){push(expected==actual,actual,expected,message)},notEqual:function(actual,expected,message){push(expected!=actual,actual,expected,message)},deepEqual:function(a,b,message){push(QUnit.equiv(a,b),a,b,message)},notDeepEqual:function(a,b,message){push(!QUnit.equiv(a,b),a,b,message)},strictEqual:function(actual,expected,message){push(expected===actual,actual,expected,message)},notStrictEqual:function(actual,expected,message){push(expected!==actual,actual,expected,message)},start:function(){window.setTimeout?window.setTimeout(function(){config.timeout&&clearTimeout(config.timeout),config.blocking=!1,process()},13):(config.blocking=!1,process())},stop:function(timeout){config.blocking=!0,timeout&&window.setTimeout&&(config.timeout=window.setTimeout(function(){QUnit.ok(!1,"Test timed out"),QUnit.start()},timeout))},reset:function(){window.jQuery&&(jQuery("#main").html(config.fixture),jQuery.event.global={},jQuery.ajaxSettings=extend({},config.ajaxSettings))},triggerEvent:function(elem,type,event){document.createEvent?(event=document.createEvent("MouseEvents"),event.initMouseEvent(type,!0,!0,elem.ownerDocument.defaultView,0,0,0,0,0,!1,!1,!1,!1,0,null),elem.dispatchEvent(event)):elem.fireEvent&&elem.fireEvent("on"+type)},is:function(type,obj){return Object.prototype.toString.call(obj)==="[object "+type+"]"},done:function(failures,total){},log:function(result,message){},testStart:function(name){},testDone:function(name,failures,total){},moduleStart:function(name,testEnvironment){},moduleDone:function(name,failures,total){}};QUnit.equals=QUnit.equal,QUnit.same=QUnit.deepEqual;var config={queue:[],blocking:!0};(function(){var location=window.location||{search:"",protocol:"file:"},GETParams=location.search.slice(1).split("&");for(var i=0;i<GETParams.length;i++)GETParams[i]=decodeURIComponent(GETParams[i]),GETParams[i]==="noglobals"?(GETParams.splice(i,1),i--,config.noglobals=!0):GETParams[i].search("=")>-1&&(GETParams.splice(i,1),i--);config.filters=GETParams,QUnit.isLocal=location.protocol==="file:"})(),typeof exports=="undefined"||typeof require=="undefined"?(extend(window,QUnit),window.QUnit=QUnit):(extend(exports,QUnit),exports.QUnit=QUnit);if(typeof document=="undefined"||document.readyState==="complete")config.autorun=!0;addEvent(window,"load",function(){var oldconfig=extend({},config);QUnit.init(),extend(config,oldconfig),config.blocking=!1;var userAgent=id("qunit-userAgent");userAgent&&(userAgent.innerHTML=navigator.userAgent);var toolbar=id("qunit-testrunner-toolbar");if(toolbar){toolbar.style.display="none";var filter=document.createElement("input");filter.type="checkbox",filter.id="qunit-filter-pass",filter.disabled=!0,addEvent(filter,"click",function(){var li=document.getElementsByTagName("li");for(var i=0;i<li.length;i++)li[i].className.indexOf("pass")>-1&&(li[i].style.display=filter.checked?"none":"")}),toolbar.appendChild(filter);var label=document.createElement("label");label.setAttribute("for","qunit-filter-pass"),label.innerHTML="Hide passed tests",toolbar.appendChild(label);var missing=document.createElement("input");missing.type="checkbox",missing.id="qunit-filter-missing",missing.disabled=!0,addEvent(missing,"click",function(){var li=document.getElementsByTagName("li");for(var i=0;i<li.length;i++)li[i].className.indexOf("fail")>-1&&li[i].innerHTML.indexOf("missing test - untested code is broken code")>-1&&(li[i].parentNode.parentNode.style.display=missing.checked?"none":"block")}),toolbar.appendChild(missing),label=document.createElement("label"),label.setAttribute("for","qunit-filter-missing"),label.innerHTML="Hide missing tests (untested code is broken code)",toolbar.appendChild(label)}var main=id("main");main&&(config.fixture=main.innerHTML),window.jQuery&&(config.ajaxSettings=window.jQuery.ajaxSettings),QUnit.start()}),QUnit.equiv=function(){function hoozit(o){return QUnit.is("String",o)?"string":QUnit.is("Boolean",o)?"boolean":QUnit.is("Number",o)?isNaN(o)?"nan":"number":typeof o=="undefined"?"undefined":o===null?"null":QUnit.is("Array",o)?"array":QUnit.is("Date",o)?"date":QUnit.is("RegExp",o)?"regexp":typeof o=="object"?"object":QUnit.is("Function",o)?"function":undefined}function bindCallbacks(o,callbacks,args){var prop=hoozit(o);if(prop)return hoozit(callbacks[prop])==="function"?callbacks[prop].apply(callbacks,args):callbacks[prop]}var innerEquiv,callers=[],parents=[],callbacks=function(){function useStrictEquality(b,a){return b instanceof a.constructor||a instanceof b.constructor?a==b:a===b}return{string:useStrictEquality,"boolean":useStrictEquality,number:useStrictEquality,"null":useStrictEquality,"undefined":useStrictEquality,nan:function(b){return isNaN(b)},date:function(b,a){return hoozit(b)==="date"&&a.valueOf()===b.valueOf()},regexp:function(b,a){return hoozit(b)==="regexp"&&a.source===b.source&&a.global===b.global&&a.ignoreCase===b.ignoreCase&&a.multiline===b.multiline},"function":function(){var caller=callers[callers.length-1];return caller!==Object&&typeof caller!="undefined"},array:function(b,a){var i,j,loop,len;if(hoozit(b)!=="array")return!1;len=a.length;if(len!==b.length)return!1;parents.push(a);for(i=0;i<len;i++){loop=!1;for(j=0;j<parents.length;j++)parents[j]===a[i]&&(loop=!0);if(!loop&&!innerEquiv(a[i],b[i]))return parents.pop(),!1}return parents.pop(),!0},object:function(b,a){var i,j,loop,eq=!0,aProperties=[],bProperties=[];if(a.constructor!==b.constructor)return!1;callers.push(a.constructor),parents.push(a);for(i in a){loop=!1;for(j=0;j<parents.length;j++)parents[j]===a[i]&&(loop=!0);aProperties.push(i);if(!loop&&!innerEquiv(a[i],b[i])){eq=!1;break}}callers.pop(),parents.pop();for(i in b)bProperties.push(i);return eq&&innerEquiv(aProperties.sort(),bProperties.sort())}}}();return innerEquiv=function(){var args=Array.prototype.slice.apply(arguments);return args.length<2?!0:function(a,b){return a===b?!0:a===null||b===null||typeof a=="undefined"||typeof b=="undefined"||hoozit(a)!==hoozit(b)?!1:bindCallbacks(a,callbacks,[b,a])}(args[0],args[1])&&arguments.callee.apply(this,args.splice(1,args.length-1))},innerEquiv}(),QUnit.jsDump=function(){function quote(str){return'"'+str.toString().replace(/"/g,'\\"')+'"'}function literal(o){return o+""}function join(pre,arr,post){var s=jsDump.separator(),base=jsDump.indent(),inner=jsDump.indent(1);return arr.join&&(arr=arr.join(","+s+inner)),arr?[pre,inner+arr,base+post].join(s):pre+post}function array(arr){var i=arr.length,ret=Array(i);this.up();while(i--)ret[i]=this.parse(arr[i]);return this.down(),join("[",ret,"]")}var reName=/^function (\w+)/,jsDump={parse:function(obj,type){var parser=this.parsers[type||this.typeOf(obj)];return type=typeof parser,type=="function"?parser.call(this,obj):type=="string"?parser:this.parsers.error},typeOf:function(obj){var type;return obj===null?type="null":typeof obj=="undefined"?type="undefined":QUnit.is("RegExp",obj)?type="regexp":QUnit.is("Date",obj)?type="date":QUnit.is("Function",obj)?type="function":obj.setInterval&&obj.document&&!obj.nodeType?type="window":obj.nodeType===9?type="document":obj.nodeType?type="node":typeof obj=="object"&&typeof obj.length=="number"&&obj.length>=0?type="array":type=typeof obj,type},separator:function(){return this.multiline?this.HTML?"<br />":"\n":this.HTML?"&nbsp;":" "},indent:function(extra){if(!this.multiline)return"";var chr=this.indentChar;return this.HTML&&(chr=chr.replace(/\t/g,"   ").replace(/ /g,"&nbsp;")),Array(this._depth_+(extra||0)).join(chr)},up:function(a){this._depth_+=a||1},down:function(a){this._depth_-=a||1},setParser:function(name,parser){this.parsers[name]=parser},quote:quote,literal:literal,join:join,_depth_:1,parsers:{window:"[Window]",document:"[Document]",error:"[ERROR]",unknown:"[Unknown]","null":"null","undefined":"undefined","function":function(fn){var ret="function",name="name"in fn?fn.name:(reName.exec(fn)||[])[1];return name&&(ret+=" "+name),ret+="(",ret=[ret,this.parse(fn,"functionArgs"),"){"].join(""),join(ret,this.parse(fn,"functionCode"),"}")},array:array,nodelist:array,arguments:array,object:function(map){var ret=[];this.up();for(var key in map)ret.push(this.parse(key,"key")+": "+this.parse(map[key]));return this.down(),join("{",ret,"}")},node:function(node){var open=this.HTML?"&lt;":"<",close=this.HTML?"&gt;":">",tag=node.nodeName.toLowerCase(),ret=open+tag;for(var a in this.DOMAttrs){var val=node[this.DOMAttrs[a]];val&&(ret+=" "+a+"="+this.parse(val,"attribute"))}return ret+close+open+"/"+tag+close},functionArgs:function(fn){var l=fn.length;if(!l)return"";var args=Array(l);while(l--)args[l]=String.fromCharCode(97+l);return" "+args.join(", ")+" "},key:quote,functionCode:"[code]",attribute:quote,string:quote,date:quote,regexp:literal,number:literal,"boolean":literal},DOMAttrs:{id:"id",name:"name","class":"className"},HTML:!1,indentChar:"   ",multiline:!1};return jsDump}()})(this)