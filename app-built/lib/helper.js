/*
  * Normalized hide address bar for iOS & Android
  * (c) Scott Jehl, scottjehl.com
  * MIT License
*/

(function(document){function addEvt(el,evt,fn,bubble){if("addEventListener"in el)try{el.addEventListener(evt,fn,bubble)}catch(e){if(typeof fn!="object"||!fn.handleEvent)throw e;el.addEventListener(evt,function(e){fn.handleEvent.call(fn,e)},bubble)}else"attachEvent"in el&&(typeof fn=="object"&&fn.handleEvent?el.attachEvent("on"+evt,function(){fn.handleEvent.call(fn)}):el.attachEvent("on"+evt,fn))}function rmEvt(el,evt,fn,bubble){if("removeEventListener"in el)try{el.removeEventListener(evt,fn,bubble)}catch(e){if(typeof fn!="object"||!fn.handleEvent)throw e;el.removeEventListener(evt,function(e){fn.handleEvent.call(fn,e)},bubble)}else"detachEvent"in el&&(typeof fn=="object"&&fn.handleEvent?el.detachEvent("on"+evt,function(){fn.handleEvent.call(fn)}):el.detachEvent("on"+evt,fn))}window.MBP=window.MBP||{},MBP.viewportmeta=document.querySelector&&document.querySelector('meta[name="viewport"]'),MBP.ua=navigator.userAgent,MBP.scaleFix=function(){MBP.viewportmeta&&/iPhone|iPad|iPod/.test(MBP.ua)&&!/Opera Mini/.test(MBP.ua)&&(MBP.viewportmeta.content="width=device-width, minimum-scale=1.0, maximum-scale=1.0",document.addEventListener("gesturestart",MBP.gestureStart,!1))},MBP.gestureStart=function(){MBP.viewportmeta.content="width=device-width, minimum-scale=0.25, maximum-scale=1.6"},MBP.BODY_SCROLL_TOP=!1,MBP.getScrollTop=function(){var win=window,doc=document;return win.pageYOffset||doc.compatMode==="CSS1Compat"&&doc.documentElement.scrollTop||doc.body.scrollTop||0},MBP.hideUrlBar=function(){var win=window;!location.hash&&MBP.BODY_SCROLL_TOP!==!1&&win.scrollTo(0,MBP.BODY_SCROLL_TOP===1?0:1)},MBP.hideUrlBarOnLoad=function(){var win=window,doc=win.document;!location.hash&&win.addEventListener&&(window.scrollTo(0,1),MBP.BODY_SCROLL_TOP=1,bodycheck=setInterval(function(){doc.body&&(clearInterval(bodycheck),MBP.BODY_SCROLL_TOP=MBP.getScrollTop(),MBP.hideUrlBar())},15),win.addEventListener("load",function(){setTimeout(function(){MBP.getScrollTop()<20&&MBP.hideUrlBar()},0)}))},MBP.fastButton=function(element,handler){this.element=element,this.handler=handler,addEvt(element,"touchstart",this,!1),addEvt(element,"click",this,!1)},MBP.fastButton.prototype.handleEvent=function(event){event=event||window.event;switch(event.type){case"touchstart":this.onTouchStart(event);break;case"touchmove":this.onTouchMove(event);break;case"touchend":this.onClick(event);break;case"click":this.onClick(event)}},MBP.fastButton.prototype.onTouchStart=function(event){event.stopPropagation(),this.element.addEventListener("touchend",this,!1),document.body.addEventListener("touchmove",this,!1),this.startX=event.touches[0].clientX,this.startY=event.touches[0].clientY,this.element.style.backgroundColor="rgba(0,0,0,.7)"},MBP.fastButton.prototype.onTouchMove=function(event){(Math.abs(event.touches[0].clientX-this.startX)>10||Math.abs(event.touches[0].clientY-this.startY)>10)&&this.reset()},MBP.fastButton.prototype.onClick=function(event){event=event||window.event,event.stopPropagation&&event.stopPropagation(),this.reset(),this.handler(event),event.type=="touchend"&&MBP.preventGhostClick(this.startX,this.startY),this.element.style.backgroundColor=""},MBP.fastButton.prototype.reset=function(){rmEvt(this.element,"touchend",this,!1),rmEvt(document.body,"touchmove",this,!1),this.element.style.backgroundColor=""},MBP.preventGhostClick=function(x,y){MBP.coords.push(x,y),window.setTimeout(function(){MBP.coords.splice(0,2)},2500)},MBP.ghostClickHandler=function(event){if(!MBP.hadTouchEvent&&"ontouchstart"in window){event.stopPropagation(),event.preventDefault();return}for(var i=0,len=MBP.coords.length;i<len;i+=2){var x=MBP.coords[i],y=MBP.coords[i+1];Math.abs(event.clientX-x)<25&&Math.abs(event.clientY-y)<25&&(event.stopPropagation(),event.preventDefault())}},document.addEventListener&&document.addEventListener("click",MBP.ghostClickHandler,!0),addEvt(document.documentElement,"touchstart",function(){MBP.hadTouchEvent=!0},!1),MBP.coords=[],MBP.splash=function(){var filename=navigator.platform==="iPad"?"h/":"l/";document.write('<link rel="apple-touch-startup-image" href="/img/'+filename+'splash.png" />')},MBP.autogrow=function(element,lh){function handler(e){var newHeight=this.scrollHeight,currentHeight=this.clientHeight;newHeight>currentHeight&&(this.style.height=newHeight+3*textLineHeight+"px")}var setLineHeight=lh?lh:12,textLineHeight=element.currentStyle?element.currentStyle.lineHeight:getComputedStyle(element,null).lineHeight;textLineHeight=textLineHeight.indexOf("px")==-1?setLineHeight:parseInt(textLineHeight,10),element.style.overflow="hidden",element.addEventListener?element.addEventListener("keyup",handler,!1):element.attachEvent("onkeyup",handler)},MBP.enableActive=function(){document.addEventListener("touchstart",function(){},!1)},MBP.viewportMeta=$('meta[name="viewport"]'),MBP.preventZoom=function(){$("input, select, textarea").bind("focus blur",function(event){MBP.viewportMeta.attr("content","width=device-width,initial-scale=1,maximum-scale="+(event.type=="blur"?10:1))})}})(document)