// Copyright 2012 FoundOPS LLC. All Rights Reserved.

define(["jquery","db/services","db/saveHistory","lib/kendo.all"],function($,dbServices,saveHistory){var routes={},vm=kendo.observable();window.routes=routes,routes.vm=vm,routes.initialize=function(){vm.set("routesSource",new kendo.data.DataSource({transport:{read:{url:dbServices.API_URL+"routes/GetRoutes",type:"GET",dataType:"jsonp",contentType:"application/json; charset=utf-8"}},change:function(e){},serverPaging:!0})),vm.refreshRoutes=function(){vm.routesSource.read()},vm.selectRoute=function(e){vm.set("selectedRoute",e.dataItem),localStorage.setItem("selectedRoute",vm.get("selectedRoute.Id")),$.publish("selectedRoute",[vm.get("selectedRoute")]),application.navigate("view/routeDetails.html")},kendo.bind($("#routes"),vm,kendo.mobile.ui)},routes.show=function(){saveHistory.close()}})