// Copyright 2012 FoundOPS LLC. All Rights Reserved.

define(["jquery","db/saveHistory","lib/kendo.all","widgets/contacts"],function($,saveHistory){var routeDestinationDetails={},vm=kendo.observable();window.routeDestinationDetails=routeDestinationDetails,routeDestinationDetails.vm=vm,$.subscribe("selectedDestination",function(data){vm.set("selectedDestination",data)});var initialized=!1;routeDestinationDetails.show=function(){saveHistory.close();if(initialized)return;if(!vm.get("selectedDestination")){application.navigate("view/routes.html");return}initialized=!0,vm.contacts=function(){return _.union(vm.get("selectedDestination.Client.ContactInfoSet").slice(0),vm.get("selectedDestination.Location.ContactInfoSet").slice(0))},vm.set("routeTasksSource",new kendo.data.DataSource({data:vm.get("selectedDestination.RouteTasks")})),vm.selectTask=function(e){vm.set("selectedTask",e.dataItem),localStorage.setItem("selectedTask",vm.get("selectedTask.Id")),$.publish("selectedTask",[vm.get("selectedTask")]),application.navigate("view/routeTask.html")},kendo.bind($("#routeDestinationDetails"),vm,kendo.mobile.ui)}})