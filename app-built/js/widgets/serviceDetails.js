define(["jquery","lib/kendo.all","lib/jquery.maskMoney","lib/jquery.autosize"],function($){var kendo=window.kendo,ui=kendo.ui,Widget=ui.Widget,DATABINDING="dataBinding",DATABOUND="dataBound",inputTemplate="<input />",multiLineTextTemplate="<textarea class='textarea'></textarea>",ServiceDetails=Widget.extend({init:function(element,options){var that=this;Widget.fn.init.call(that,element,options),that.render()},events:[DATABINDING,DATABOUND],items:function(){return this.element.children()},_createTextBoxField:function(field,fieldIndex,listView){var fieldElement;return field.IsMultiLine?(fieldElement=$(multiLineTextTemplate).autosize(),fieldElement.appendTo(listView).wrap("<li>"+field.Name+"</li>")):(fieldElement=$(inputTemplate),fieldElement.attr("type","text"),fieldElement.appendTo(listView).wrap("<li>"+field.Name+"</li>")),fieldElement},_createNumericField:function(field,fieldIndex,listView){var fieldElement=$(inputTemplate).attr("type","number"),step=1/Math.pow(10,field.DecimalPlaces);return fieldElement.attr("step",step).attr("min",field.Minimum).attr("max",field.Maximum).appendTo(listView).wrap("<li>"+field.Name+"</li>"),field.Mask==="c"?$("<span> $</span>").insertBefore(fieldElement):field.Mask==="p"&&$("<span>%</span>").insertAfter(fieldElement),fieldElement},_createDateTimeField:function(field,fieldIndex,listView){var fieldElement=$(inputTemplate).appendTo(listView).wrap("<li>"+field.Name+"</li>"),options={change:function(e){var newValue=e.sender.value();newValue&&e.sender.fieldParent.set("Value",newValue)},min:field.Earliest,max:field.Latest},picker;return field.TypeInt===0?(options.value=moment(field.Value).format("LLL"),picker=fieldElement.kendoDateTimePicker(options).data("kendoDateTimePicker")):field.TypeInt===1?(options.value=moment(field.Value).format("LT"),picker=fieldElement.kendoTimePicker(options).data("kendoTimePicker")):field.TypeInt===2&&(options.value=moment(field.Value).format("LL"),picker=fieldElement.kendoDatePicker(options).data("kendoDatePicker")),picker.fieldParent=field,fieldElement},_createOptionsField:function(field,fieldIndex,elementToAppendTo){var fieldElement;if(field.TypeInt===0){fieldElement=$(inputTemplate).appendTo(elementToAppendTo).wrap("<li><label>"+field.Name+"</label></li>"),fieldElement.kendoComboBox({change:function(e){var index=this.selectedIndex,field=this.fieldParent;for(var i=0;i<field.Options.length;i++)field.Options[i].IsChecked=!1;index>=0&&(field.Options[index].IsChecked=!0)},dataTextField:"Name",dataValueField:"Id",dataSource:field.Options,filter:"contains",suggest:!0});var comboBox=fieldElement.data("kendoComboBox");comboBox.fieldParent=field,comboBox.select(function(dataItem){return dataItem.IsChecked})}else{fieldElement=$('<ul data-role="listview" data-style="inset">'+field.Name+"</ul>").appendTo(elementToAppendTo);for(var optionIndex=0;optionIndex<field.Options.length;optionIndex++){var optionElement=$(inputTemplate).attr("type","checkbox"),option=field.Options[optionIndex];optionElement[0].optionParent=option,option.IsChecked&&optionElement.attr("checked","checked"),optionElement.change(function(){var checked=!$(this).is(":checked");$(this)[0].optionParent.IsChecked=checked}),optionElement.appendTo(fieldElement).wrap("<li><label>"+option.Name+"</label></li>")}}return fieldElement},render:function(service){var that=this;that.trigger(DATABINDING),that.element.empty();var fieldCreationFunctions={TextBoxField:that._createTextBoxField,NumericField:that._createNumericField,DateTimeField:that._createDateTimeField,OptionsField:that._createOptionsField},fieldsListView=$('<ul data-role="listview" data-style="inset"></ul>').appendTo(that.element).wrap("<form></form>"),checkLists=$("<div></div>").appendTo(that.element);if(service){for(var fieldIndex=0;fieldIndex<service.Fields.length;fieldIndex++){var field=service.Fields[fieldIndex],checkField=field.Type==="OptionsField"&&(field.TypeInt===1||field.TypeInt===2),elementToAppendTo=checkField?checkLists:fieldsListView,fieldElement=fieldCreationFunctions[field.Type](field,fieldIndex,elementToAppendTo);if(fieldElement){field.ToolTip&&fieldElement.attr("text",field.ToolTip);if(field.Type!=="OptionsField"&&field.Type!=="DateTimeField"){var dataBindAttr="value: Fields["+fieldIndex+"].Value";fieldElement.attr("data-bind",dataBindAttr)}}}kendo.bind(fieldsListView,service,kendo.mobile.ui),kendo.bind(checkLists,service,kendo.mobile.ui)}that.trigger(DATABOUND)},options:new kendo.data.ObservableObject({name:"ServiceDetails"})});ui.plugin(ServiceDetails),kendo.data.binders.service=kendo.data.Binder.extend({init:function(element,bindings,options){kendo.data.Binder.fn.init.call(this,element,bindings,options)},refresh:function(e){var service=this.bindings.service.get(),serviceDetails=$(this.element).data("kendoServiceDetails");serviceDetails&&serviceDetails.render(service)}})})