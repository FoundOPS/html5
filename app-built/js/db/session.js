// Copyright 2012 FoundOPS LLC. All Rights Reserved.

define(["db/services","lib/kendo.all"],function(dbservices){var session=new kendo.data.ObservableObject({});window.session=session,session.setRole=function(role){session.set("role",role),dbservices.setRoleId(role.id)},session.load=function(callback){if(session._data){callback(session._data);return}dbservices.getSession(function(data){session._data=data,session.setRole(data.roles[0]),callback(session._data)})};var roleFunctions=[];return session.followRole=function(setProperty){roleFunctions.push(setProperty);var role=session.get("role");role&&setProperty(role)},session.bind("change",function(e){if(e.field==="role"){var role=session.get("role");if(role)for(var i=0;i<roleFunctions.length;i++)roleFunctions[i](role)}}),session})