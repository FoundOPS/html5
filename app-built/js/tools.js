// Copyright 2012 FoundOPS LLC. All Rights Reserved.

define([],function(){var tools={};return tools.convertArray=function(items,converter){var convertedData=[],i;for(i in items)convertedData.push(converter(items[i]));return convertedData},tools.dateEqual=function(a,b,ignoreUtc){return ignoreUtc?a.getDate()===b.getDate()&&a.getMonth()===b.getMonth()&&a.getFullYear()===b.getFullYear():a.getUTCDate()===b.getUTCDate()&&a.getUTCMonth()===b.getUTCMonth()&&a.getUTCFullYear()===b.getUTCFullYear()},tools.formatDate=function(date){typeof date=="string"&&(date=new Date(date));var month=date.getUTCMonth()+1,day=date.getUTCDate(),year=date.getUTCFullYear();return month+"-"+day+"-"+year},tools.stripTimeZone=function(date){return new Date(Date.UTC(date.getFullYear(),date.getMonth(),date.getDate()))},tools.getDirection=function(deg){deg=Math.abs(deg),deg%=360;var dir;return deg>=0&&deg<=11.25||deg>348.75&&deg<=360?dir="N":deg>11.25&&deg<=33.75?dir="NNE":deg>33.75&&deg<=56.25?dir="NE":deg>56.25&&deg<=78.75?dir="ENE":deg>78.75&&deg<=101.25?dir="E":deg>101.25&&deg<=123.75?dir="ESE":deg>123.75&&deg<=146.25?dir="SE":deg>146.25&&deg<=168.75?dir="SSE":deg>168.75&&deg<=191.25?dir="S":deg>191.25&&deg<=213.75?dir="SSW":deg>213.75&&deg<=236.25?dir="SW":deg>236.25&&deg<=258.75?dir="WSW":deg>258.75&&deg<=281.25?dir="W":deg>281.25&&deg<=303.75?dir="WNW":deg>303.75&&deg<=326.25?dir="NW":dir="NNW",dir},tools.newGuid=function(){var newGuidString="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){var r=Math.random()*16|0,v=c==="x"?r:r&3|8;return v.toString(16)});return newGuidString},tools.toCSV=function(data,fileName,humanize,ignore){var csv="";ignore||(ignore=[]),ignore=_.union(ignore,["_events","idField","_defaultId","constructor","init","get","_set","wrap","bind","one","first","trigger","unbind","uid","dirty","id","parent"]);if(data.length>0){for(var col in data[0]){if(!data[0].hasOwnProperty(col)||_.include(ignore,col))continue;humanize&&(col=col.split("_").join(" ").replace(/([A-Z])/g," $1")),col=col.replace(/"/g,'""'),csv+='"'+col+'"',col!=data[0].length-1&&(csv+=",")}csv+="\n"}for(var row in data){for(var col in data[row]){if(!data[row].hasOwnProperty(col)||_.include(ignore,col))continue;var value=data[row][col];value===null?value="":value instanceof Date?value=moment(value).format("MM/D/YYYY"):value=value.toString(),value=value.replace(/"/g,'""'),csv+='"'+value+'"',col!==data[row].length-1&&(csv+=",")}csv+="\n"}return csv},tools.ValueSelector=function(values){this.values=values,this.keysCache=[]},tools.ValueSelector.prototype.getValue=function(key){var index=_.indexOf(this.keysCache,key);index===-1&&(this.keysCache.push(key),index=this.keysCache.length-1);var valueIndex=index%this.values.length;return this.values[valueIndex]},tools.resizeImage=function(element,maxSize,containerWidth){var width=element[0].width,height=element[0].height,w=maxSize/width,h=maxSize/height,ratio=Math.min(w,h),newW=ratio*width,newH=ratio*height;element.css("width",newW+"px"),element.css("height",newH+"px");var margin=(containerWidth-newW)/2;element.css("marginLeft",margin+"px")},tools.enableButtons=function(page){$(page+" .cancelBtn").removeAttr("disabled"),$(page+" .saveBtn").removeAttr("disabled")},tools.disableButtons=function(page){$(page+" .cancelBtn").attr("disabled","disabled"),$(page+" .saveBtn").attr("disabled","disabled")},tools.observeInput=function(pageDiv){$(pageDiv+" input").each(function(){$(this).data("oldVal",$(this).val()),$(this).bind("propertychange keyup input paste change",function(){$(this).data("oldVal")!=$(this).val()&&($(this).data("oldVal",$(this).val()),tools.enableButtons(pageDiv))})})},tools.getLocalTimeZone=function(){var today=(new Date).toString(),timezone,id;return today.match(/Eastern/)?(timezone="(UTC-05:00) Eastern Time (US & Canada)",id="Eastern Standard Time"):today.match(/Central/)?(timezone="(UTC-06:00) Central Time (US & Canada)",id="Central Standard Time"):today.match(/Mountain/)?(timezone="(UTC-07:00) Mountain Time (US & Canada)",id="Mountain Standard Time"):today.match(/Pacific/)?(timezone="(UTC-08:00) Pacific Time (US & Canada)",id="Pacific Standard Time"):today.match(/Alaska/)?(timezone="(UTC-09:00) Alaska",id="Alaskan Standard Time"):today.match(/Hawaii/)&&(timezone="(UTC-10:00) Hawaii",id="Hawaiian Standard Time"),{DisplayName:timezone,TimeZoneId:id}},tools})