var grid,busAcctId,selectedItem;$(document).ready(function(){var baseUrl="http://localhost:9711/api/TaskStatus/",roleId="68698f53-a894-4db2-9b65-995287b2580f",dataSource=new kendo.data.DataSource({transport:{read:{url:baseUrl+"GetStatuses?roleId="+roleId,type:"GET",dataType:"jsonp",contentType:"application/json; charset=utf-8"},update:{url:baseUrl+"UpdateTaskStatus",type:"POST"},destroy:{url:baseUrl+"DeleteTaskStatus",type:"POST"},create:{url:baseUrl+"InsertTaskStatus",type:"POST"}},schema:{model:{id:"Id",fields:{Id:{type:"hidden"},BusinessAccountId:{type:"hidden"},Name:{type:"string",validation:{required:!0},defaultValue:"New Status"},Color:{type:"string",defaultValue:"#FFFFFF"},RouteRequired:{type:"boolean"},DefaultTypeInt:{type:"number",editable:!1,defaultValue:null}}}}});$("#grid").kendoGrid({columns:[{field:"Name",title:"Name"},{width:55,field:"Color",title:"Color",editor:colorEditor,template:"<div class='gridColor' style='background-color: #=Color#'></div>"},{field:"RouteRequired",title:"Remove from Route on Selection",template:"#= getChecked(RouteRequired)#"},{field:"DefaultTypeInt",title:"Attributes",template:"#= getAttributeText(DefaultTypeInt) #"}],dataSource:dataSource,dataBound:onDataBound,editable:!0,remove:function(){hideOrShowSaveCancel(!0)},scrollable:!1,selectable:!0,sortable:!0,save:function(){hideOrShowSaveCancel(!0)},saveChanges:function(){hideOrShowSaveCancel(!1)},toolbar:[{name:"create",text:"Add New Row"},{name:"save",text:"Save Changes"},{name:"cancel",text:"Cancel Changes"},{name:"destroy",template:"<a class='k-button k-button-icontext k-grid-delete' onclick='removeSelectedRow()'><span class='k-icon k-delete'></span>Delete</a>"}]})});var disableDefaultCheckboxes=function(){$("input[type='checkbox']").each(function(i){var int=grid._data[i].DefaultTypeInt;int!==null&&(this.disabled=!0)})},getChecked=function(checked){return checked===!0?"<input type='checkbox' checked onclick='updateCheckbox(checked)'/>":"<input type='checkbox' onclick='updateCheckbox(checked)' />"},updateCheckbox=function(checked){selectedItem.set("RouteRequired",checked),hideOrShowSaveCancel(!0)},addColorPicker=function(){$(".colorSelector2").ColorPicker({color:grid.dataItem(grid.select()).Color,onShow:function(colpkr){return $(colpkr).css("z-index","1000"),$(colpkr).fadeIn(200),!1},onHide:function(colpkr){return $(colpkr).fadeOut(200),!1},onChange:function(hsb,hex){var color="#"+hex;updateColor(color)}})},colorEditor=function(container,options){$("<input class='colorInput' data-text-field='Color' data-value-field='Color' data-bind='value:"+options.field+"'/>"+"<div class='customWidget'><div class='colorSelector2'><div class='innerSelector' style='background-color:"+options.model.Color+"'></div></div><div class='colorpickerHolder2'></div></div>").appendTo(container),addColorPicker()},updateColor=function(color){selectedItem.set("Color",color),hideOrShowSaveCancel(!0)},getAttributeText=function(int){return int===1?"Default status for newly created tasks":int===2?"Default status when placed into a route":int===3?"Task completed":""},onDataBound=function(){grid=$("#grid").data("kendoGrid"),disableDefaultCheckboxes(),busAcctId=grid._data[1].BusinessAccountId,grid.bind("change",function(){hideOrShowDeleteBtn(),selectedItem=grid.dataItem(grid.select())}),$(".k-grid-cancel-changes").click(function(){hideOrShowSaveCancel(!1),$(".k-grid-delete").css("display","none"),grid.dataSource.read()}),$(".k-grid-add").click(function(){hideOrShowSaveCancel(!0)}),grid.bind("edit",function(e){disableDefaultCheckboxes(),e.sender._editContainer.context&&e.sender._editContainer.context.cellIndex==1&&$(".colorSelector2").ColorPickerShow(),e.model.BusinessAccountId||(e.model.BusinessAccountId=busAcctId),e.model.Id||(e.model.Id=guidGenerator())})},removeSelectedRow=function(){var row=getSelectedRow(grid);grid.removeRow(row)},guidGenerator=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){var r=Math.random()*16|0,v=c==="x"?r:r&3|8;return v.toString(16)})},hideOrShowDeleteBtn=function(){var row=getSelectedRow(grid);row[0].cells[3].innerHTML!==""?$(".k-grid-delete").css("display","none"):$(".k-grid-delete").css("display","inline-block")},hideOrShowSaveCancel=function(hasChanges){hasChanges?($(".k-grid-save-changes").css("display","inline-block"),$(".k-grid-cancel-changes").css("display","inline-block")):($(".k-grid-save-changes").css("display","none"),$(".k-grid-cancel-changes").css("display","none"))},getSelectedRow=function(g){return g.tbody.find(".k-state-selected")}